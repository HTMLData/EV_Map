# EV充电桩地图应用 - 接口调用说明

## 📋 概述

本文档详细说明了EV充电桩地图应用中所有API接口的调用方式、参数说明和返回格式。

## 🔧 基础配置

### API基础地址
```javascript
// 真实API地址（生产环境）
const API_BASE_URL = '/api'

// Mock数据地址（开发环境）
const MOCK_BASE_URL = '/mock'
```

### 请求头配置
```javascript
// Axios请求配置
const headers = {
  'Content-Type': 'application/json',
  'Accept': 'application/json'
}
```

## 📡 接口列表

### 1. 获取充电桩列表

#### 接口信息
- **接口名称**: 获取充电桩列表
- **请求方法**: `GET`
- **接口路径**: `/api/stations` 或 `/mock/stationList.json`
- **功能描述**: 获取指定区域内的充电桩列表信息

#### 请求参数
```javascript
// Query参数（可选）
{
  "lat": 31.750941,        // 纬度（可选）
  "lng": 117.26107,         // 经度（可选）
  "radius": 5000,           // 搜索半径（米，可选）
  "chargeType": "all",      // 充电类型：all/quick/slow
  "openStatus": "all",      // 营业状态：all/1/0
  "brandType": "all"        // 品牌类型：all/1/2/3/4/5/6
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "success",
  "data": {
    "stationList": [
      {
        "stationId": "VW_STATION_001",
        "stationName": "合肥万达广场充电站",
        "address": "安徽省合肥市包河区万达广场地下停车场",
        "lat": 31.750941,
        "lng": 117.26107,
        "openStatus": 1,
        "quickAvailableNum": 8,
        "quickChargeNum": 10,
        "slowAvailableNum": 12,
        "slowChargeNum": 15,
        "totalCostPrice": 1.2,
        "openTime": "24小时营业",
        "brandName": "大众充电",
        "distance": 1.2
      }
    ],
    "total": 8,
    "pageSize": 20,
    "currentPage": 1
  }
}
```

#### 调用示例
```javascript
// 使用stationService
import { stationAPI } from '@/api/stationService'

// 获取所有充电桩
const stations = await stationAPI.getStations()

// 带参数查询
const stations = await stationAPI.getStations({
  lat: 31.750941,
  lng: 117.26107,
  radius: 5000,
  chargeType: 'quick'
})
```

### 2. 获取充电桩详情

#### 接口信息
- **接口名称**: 获取充电桩详情
- **请求方法**: `GET`
- **接口路径**: `/api/stations/{stationId}` 或 `/mock/stationDetail.json`
- **功能描述**: 获取指定充电桩的详细信息

#### 请求参数
```javascript
// Path参数
{
  "stationId": "VW_STATION_001"  // 充电桩ID（必填）
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "success",
  "data": {
    "stationId": "VW_STATION_001",
    "stationName": "合肥万达广场充电站",
    "address": "安徽省合肥市包河区万达广场地下停车场",
    "busineHours": "24小时营业",
    "parkFee": "免费停车2小时",
    "serviceTel": "400-123-4567",
    "pictures": [
      "https://example.com/image1.jpg",
      "https://example.com/image2.jpg"
    ],
    "fastConnectors": [
      {
        "connectorId": "FC001",
        "power": 60,
        "status": "空闲"
      }
    ],
    "slowConnectors": [
      {
        "connectorId": "SC001",
        "power": 7,
        "status": "空闲"
      }
    ],
    "periodPrices": [
      {
        "eleFee": 0.8,
        "serviceFee": 0.4,
        "startTime": "00:00",
        "endTime": "08:00",
        "totalFee": 1.2
      }
    ]
  }
}
```

#### 调用示例
```javascript
// 获取充电桩详情
const detail = await stationAPI.getStationDetail('VW_STATION_001')
```

### 3. 开始充电会话

#### 接口信息
- **接口名称**: 开始充电会话
- **请求方法**: `POST`
- **接口路径**: `/api/charging/start`
- **功能描述**: 开始一个新的充电会话

#### 请求参数
```javascript
{
  "stationId": "VW_STATION_001",
  "connectorId": "FC001",
  "userId": "user123",
  "vehicleId": "vehicle456"
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "充电会话开始成功",
  "data": {
    "sessionId": "session789",
    "startTime": "2024-01-15T10:30:00Z",
    "estimatedEndTime": "2024-01-15T12:30:00Z",
    "estimatedCost": 15.6
  }
}
```

#### 调用示例
```javascript
// 开始充电
const session = await stationAPI.startCharging({
  stationId: 'VW_STATION_001',
  connectorId: 'FC001',
  userId: 'user123',
  vehicleId: 'vehicle456'
})
```

### 4. 结束充电会话

#### 接口信息
- **接口名称**: 结束充电会话
- **请求方法**: `POST`
- **接口路径**: `/api/charging/stop`
- **功能描述**: 结束当前充电会话

#### 请求参数
```javascript
{
  "sessionId": "session789"
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "充电会话结束成功",
  "data": {
    "sessionId": "session789",
    "endTime": "2024-01-15T12:25:00Z",
    "totalEnergy": 25.6,
    "totalCost": 30.72,
    "chargingTime": 115  // 分钟
  }
}
```

#### 调用示例
```javascript
// 结束充电
const result = await stationAPI.stopCharging('session789')
```

### 5. 获取充电状态

#### 接口信息
- **接口名称**: 获取充电状态
- **请求方法**: `GET`
- **接口路径**: `/api/charging/status/{sessionId}`
- **功能描述**: 获取当前充电会话的实时状态

#### 请求参数
```javascript
// Path参数
{
  "sessionId": "session789"  // 充电会话ID（必填）
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "success",
  "data": {
    "sessionId": "session789",
    "status": "charging",  // charging/completed/error
    "progress": 65,        // 充电进度百分比
    "energyCharged": 16.6, // 已充电量（kWh）
    "currentPower": 60,    // 当前功率（kW）
    "estimatedTime": 25,   // 预计剩余时间（分钟）
    "currentCost": 19.92  // 当前费用
  }
}
```

#### 调用示例
```javascript
// 获取充电状态
const status = await stationAPI.getChargingStatus('session789')
```

### 6. 创建支付订单

#### 接口信息
- **接口名称**: 创建支付订单
- **请求方法**: `POST`
- **接口路径**: `/api/payment/create`
- **功能描述**: 为充电会话创建支付订单

#### 请求参数
```javascript
{
  "sessionId": "session789",
  "amount": 30.72,
  "paymentMethod": "wechat"  // wechat/alipay/credit
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": "order123",
    "amount": 30.72,
    "status": "pending",
    "qrCode": "weixin://wxpay/bizpayurl?pr=xxx",
    "expireTime": "2024-01-15T12:35:00Z"
  }
}
```

#### 调用示例
```javascript
// 创建支付订单
const order = await stationAPI.createPaymentOrder({
  sessionId: 'session789',
  amount: 30.72,
  paymentMethod: 'wechat'
})
```

### 7. 处理支付

#### 接口信息
- **接口名称**: 处理支付
- **请求方法**: `POST`
- **接口路径**: `/api/payment/process`
- **功能描述**: 处理支付请求

#### 请求参数
```javascript
{
  "orderId": "order123",
  "paymentMethod": "wechat",
  "paymentData": {
    "transactionId": "wx123456789"
  }
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "支付成功",
  "data": {
    "orderId": "order123",
    "status": "paid",
    "paidAt": "2024-01-15T12:30:00Z",
    "transactionId": "wx123456789"
  }
}
```

#### 调用示例
```javascript
// 处理支付
const result = await stationAPI.processPayment({
  orderId: 'order123',
  paymentMethod: 'wechat',
  paymentData: {
    transactionId: 'wx123456789'
  }
})
```

### 8. 计算距离

#### 接口信息
- **接口名称**: 计算距离
- **请求方法**: `POST`
- **接口路径**: `/api/utils/distance`
- **功能描述**: 计算两点之间的距离

#### 请求参数
```javascript
{
  "origin": {
    "lat": 31.750941,
    "lng": 117.26107
  },
  "destination": {
    "lat": 31.760941,
    "lng": 117.27107
  }
}
```

#### 返回格式
```javascript
{
  "code": 200,
  "message": "success",
  "data": {
    "distance": 1.2,  // 距离（公里）
    "duration": 5     // 预计时间（分钟）
  }
}
```

#### 调用示例
```javascript
// 计算距离
const distance = await stationAPI.calculateDistance({
  origin: { lat: 31.750941, lng: 117.26107 },
  destination: { lat: 31.760941, lng: 117.27107 }
})
```

## 🔄 错误处理

### 错误码说明
```javascript
{
  "code": 400,           // 错误码
  "message": "参数错误",  // 错误信息
  "data": null
}
```

### 常见错误码
- `200`: 成功
- `400`: 请求参数错误
- `401`: 未授权
- `403`: 禁止访问
- `404`: 资源不存在
- `500`: 服务器内部错误

### 错误处理示例
```javascript
try {
  const result = await stationAPI.getStations()
  // 处理成功结果
} catch (error) {
  if (error.response) {
    // 服务器返回错误
    console.error('API错误:', error.response.data.message)
  } else if (error.request) {
    // 网络错误
    console.error('网络错误:', error.message)
  } else {
    // 其他错误
    console.error('未知错误:', error.message)
  }
}
```

## 📝 使用说明

### 1. 在Vue组件中使用
```javascript
import { stationAPI } from '@/api/stationService'

export default {
  async mounted() {
    try {
      const stations = await stationAPI.getStations()
      this.stations = stations.stationList
    } catch (error) {
      console.error('获取充电桩列表失败:', error)
    }
  }
}
```

### 2. 在Pinia Store中使用
```javascript
import { stationAPI } from '@/api/stationService'

export const useStationStore = defineStore('station', {
  actions: {
    async fetchStations() {
      try {
        const response = await stationAPI.getStations()
        this.stations = response.stationList
      } catch (error) {
        this.error = '加载充电桩数据失败'
      }
    }
  }
})
```

### 3. Mock数据模式
当真实API不可用时，系统会自动切换到Mock数据模式：
```javascript
// 自动降级到Mock数据
const stations = await stationAPI.getStations() // 会尝试真实API，失败后使用Mock
```

## 🔧 开发调试

### 启用调试模式
```javascript
// 在stationService.js中设置
const DEBUG = true

if (DEBUG) {
  console.log('API调用:', url, params)
}
```

### 网络请求拦截
```javascript
// 请求拦截器
mockClient.interceptors.request.use(
  config => {
    console.log('发送请求:', config.url)
    return config
  },
  error => {
    console.error('请求错误:', error)
    return Promise.reject(error)
  }
)

// 响应拦截器
mockClient.interceptors.response.use(
  response => {
    console.log('收到响应:', response.data)
    return response.data
  },
  error => {
    console.error('响应错误:', error)
    return Promise.reject(error)
  }
)
```

## 📋 注意事项

1. **API密钥**: 确保高德地图API密钥配置正确
2. **跨域问题**: 开发环境已配置代理，生产环境需要后端支持CORS
3. **数据格式**: 所有接口返回数据格式统一，包含code、message、data字段
4. **错误处理**: 建议在所有API调用中添加try-catch错误处理
5. **Mock数据**: 开发阶段使用Mock数据，生产环境需要真实API支持

## 🔗 相关文档

- [高德地图API文档](https://lbs.amap.com/api/jsapi-v2/documentation)
- [Vue 3 官方文档](https://vuejs.org/)
- [Pinia 状态管理](https://pinia.vuejs.org/)
- [Axios 请求库](https://axios-http.com/)
